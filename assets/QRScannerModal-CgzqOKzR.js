import{r as e,j as r,_ as a,X as t,$ as s,a as o,J as l}from"./vendor-CjuAVZ7F.js";import{u as n}from"./index-DN0dzhwU.js";import{m as i}from"./ui-CiILanuQ.js";import"./firebase-DuvuO4R-.js";const c=({onClose:c,onScanSuccess:d})=>{const[m,x]=e.useState(""),[b,u]=e.useState(""),[h,g]=e.useState("camera"),[v,p]=e.useState(!1),[f,j]=e.useState(!1),w=e.useRef(null),y=e.useRef(null),N=e.useRef(null),{success:k,error:C}=n();e.useEffect(()=>("camera"===h?R():S(),()=>{S()}),[h]);const R=async()=>{try{x(""),j(!1);const e=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:{ideal:400},height:{ideal:400}}});y.current&&(y.current.srcObject=e,N.current=e,y.current.onloadedmetadata=()=>{y.current.play(),j(!0),Q()})}catch(e){x("Camera toegang geweigerd. Gebruik de handmatige invoer optie."),g("manual")}},S=()=>{N.current&&(N.current.getTracks().forEach(e=>e.stop()),N.current=null),j(!1)},Q=()=>{if(!y.current||!f)return;const e=document.createElement("canvas"),r=e.getContext("2d"),a=()=>{if(y.current&&f&&!v)try{e.width=y.current.videoWidth,e.height=y.current.videoHeight,r.drawImage(y.current,0,0),f&&!v&&setTimeout(a,100)}catch(t){}};a()},G=e=>{try{p(!0);const r=window.location.hash;c(),setTimeout(()=>{d(e),setTimeout(()=>{window.location.hash!==r&&(window.location.hash=r)},100),k("QR-code succesvol gescand! ðŸŽ‰")},100)}catch(r){C("Fout bij verwerken van QR-code"),p(!1)}};return r.jsx(i.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-50 flex items-start lg:pt-[88px] justify-center p-4 z-50",onClick:c,children:r.jsxs(i.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"bg-[rgb(var(--card-bg))] rounded-2xl shadow-xl max-w-md w-full max-h-[calc(100vh-88px)] overflow-hidden mt-0",onClick:e=>e.stopPropagation(),children:[r.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-[rgb(var(--border-color))]/20",children:[r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx("div",{className:"w-10 h-10 bg-[rgb(var(--primary-color))]/20 rounded-xl flex items-center justify-center",children:r.jsx(a,{className:"w-5 h-5 text-[rgb(var(--primary-color))]"})}),r.jsx("h2",{className:"text-xl font-bold text-[rgb(var(--card-text))]",children:"QR-code scannen"})]}),r.jsx("button",{onClick:c,className:"p-2 rounded-xl hover:bg-[rgb(var(--border-color))]/20 transition-colors",children:r.jsx(t,{className:"w-5 h-5 text-[rgb(var(--text-color))]/60"})})]}),r.jsxs("div",{className:"p-6 space-y-6",children:[r.jsxs("div",{className:"flex space-x-3",children:[r.jsxs("button",{onClick:()=>{g("camera"),x(""),p(!1)},className:"flex-1 flex items-center justify-center px-4 py-3 rounded-xl transition-all duration-200 font-medium "+("camera"===h?"bg-[rgb(var(--color-primary-button))] text-white shadow-lg":"bg-[rgb(var(--border-color))]/20 text-[rgb(var(--text-color))]/80 hover:bg-[rgb(var(--border-color))]/30"),children:[r.jsx(s,{className:"w-4 h-4 mr-2"}),"Camera"]}),r.jsx("button",{onClick:()=>{g("manual"),x(""),p(!1)},className:"flex-1 flex items-center justify-center px-4 py-3 rounded-xl transition-all duration-200 font-medium "+("manual"===h?"bg-[rgb(var(--color-primary-button))] text-white shadow-lg":"bg-[rgb(var(--border-color))]/20 text-[rgb(var(--text-color))]/80 hover:bg-[rgb(var(--border-color))]/30"),children:"Handmatig"})]}),"camera"===h?r.jsx("div",{className:"space-y-4",children:m?r.jsxs("div",{className:"text-center py-8",children:[r.jsx("div",{className:"w-16 h-16 bg-[rgb(var(--error-color))]/20 rounded-full flex items-center justify-center mx-auto mb-4",children:r.jsx(o,{className:"w-8 h-8 text-[rgb(var(--error-color))]"})}),r.jsx("p",{className:"text-[rgb(var(--text-color))]/80 mb-6 leading-relaxed",children:m}),r.jsx("button",{onClick:()=>g("manual"),className:"px-6 py-3 bg-[rgb(var(--color-primary-button))] hover:opacity-90 text-white rounded-xl font-medium transition-all duration-200 shadow-lg hover:shadow-xl transform hover:scale-105",children:"Gebruik handmatige invoer"})]}):r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"relative bg-black rounded-2xl overflow-hidden aspect-square",children:[r.jsx("video",{ref:y,className:"w-full h-full object-cover",autoPlay:!0,playsInline:!0,muted:!0}),r.jsx("div",{className:"absolute inset-0 pointer-events-none",children:r.jsx("div",{className:"absolute inset-4 border-2 border-white/30 rounded-2xl",children:r.jsxs("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-48 h-48 border-2 border-white rounded-xl",children:[r.jsx("div",{className:"absolute -top-1 -left-1 w-6 h-6 border-t-4 border-l-4 border-[rgb(var(--primary-color))] rounded-tl-lg"}),r.jsx("div",{className:"absolute -top-1 -right-1 w-6 h-6 border-t-4 border-r-4 border-[rgb(var(--primary-color))] rounded-tr-lg"}),r.jsx("div",{className:"absolute -bottom-1 -left-1 w-6 h-6 border-b-4 border-l-4 border-[rgb(var(--primary-color))] rounded-bl-lg"}),r.jsx("div",{className:"absolute -bottom-1 -right-1 w-6 h-6 border-b-4 border-r-4 border-[rgb(var(--primary-color))] rounded-br-lg"})]})})}),!f&&r.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center",children:r.jsxs("div",{className:"bg-white rounded-xl px-4 py-2 flex items-center space-x-2",children:[r.jsx("div",{className:"w-4 h-4 border-2 border-[rgb(var(--primary-color))] border-t-transparent rounded-full animate-spin"}),r.jsx("span",{className:"text-sm font-medium",children:"Camera starten..."})]})}),v&&r.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center",children:r.jsxs("div",{className:"bg-white rounded-xl px-4 py-2 flex items-center space-x-2",children:[r.jsx("div",{className:"w-4 h-4 border-2 border-[rgb(var(--primary-color))] border-t-transparent rounded-full animate-spin"}),r.jsx("span",{className:"text-sm font-medium",children:"Verwerken..."})]})})]}),r.jsxs("div",{className:"text-center space-y-4",children:[r.jsx("p",{className:"text-[rgb(var(--text-color))]/80 leading-relaxed",children:"Camera is gestart. Gebruik handmatige invoer voor het beste resultaat."}),r.jsx("div",{className:"flex space-x-3",children:r.jsxs("label",{className:"flex-1 flex items-center justify-center px-4 py-3 bg-[rgb(var(--color-secondary-button))] hover:opacity-90 text-white rounded-xl cursor-pointer transition-all duration-200 font-medium shadow-lg hover:shadow-xl transform hover:scale-105",children:[r.jsx(l,{className:"w-4 h-4 mr-2"}),"Upload Afbeelding",r.jsx("input",{ref:w,type:"file",accept:"image/*",onChange:e=>{e.target.files[0]&&(C("Upload functie wordt nog verbeterd. Gebruik handmatige invoer voor nu."),g("manual"))},className:"hidden"})]})})]})]})}):r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-semibold text-[rgb(var(--text-color))]/80 mb-3",children:"Plak de gedeelde link of QR-code hier:"}),r.jsx("input",{type:"text",value:b,onChange:e=>u(e.target.value),placeholder:"https://... of QR-code tekst",className:"w-full px-4 py-4 border border-[rgb(var(--border-color))]/30 rounded-xl focus:outline-none focus:ring-2 focus:ring-[rgb(var(--primary-color))] focus:border-transparent bg-[rgb(var(--card-bg))] text-[rgb(var(--card-text))] placeholder-[rgb(var(--text-color))]/40 transition-all duration-200"})]}),r.jsx("button",{onClick:()=>{b.trim()&&G(b.trim())},disabled:!b.trim()||v,className:"w-full flex items-center justify-center px-6 py-4 bg-[rgb(var(--color-primary-button))] hover:opacity-90 text-white rounded-xl shadow-lg hover:shadow-xl transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none transition-all duration-200 font-semibold",children:v?r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin mr-3"}),r.jsx("span",{children:"Verwerken..."})]}):r.jsxs(r.Fragment,{children:[r.jsx(a,{className:"w-5 h-5 mr-3"}),r.jsx("span",{children:"Code Verwerken"})]})})]})]})]})})};export{c as default};
