import{r as e,j as t,a as r,a1 as a,a2 as n,P as s}from"./vendor-CjuAVZ7F.js";import{u as i,C as o,E as l}from"./index-DN0dzhwU.js";import{m as c,A as u}from"./ui-CiILanuQ.js";import"./firebase-DuvuO4R-.js";const d=({onTranscript:s,placeholder:o="Spreek uit...",language:l="nl-NL",className:d="",autoSubmit:g=!1})=>{const{isListening:p,transcript:m,isSupported:h,error:x,isTimingOut:b,remainingTime:f,startListening:w,stopListening:v,resetTranscript:k}=((t="nl-NL")=>{const[r,a]=e.useState(!1),[n,s]=e.useState(""),[i,o]=e.useState(!1),[l,c]=e.useState(""),[u,d]=e.useState(null),[g]=e.useState(3e3),[p,m]=e.useState(0),[h]=e.useState(1e3),[x,b]=e.useState(!1),[f,w]=e.useState(0),v=e.useRef(null),k=e.useRef(null),y=e.useCallback(()=>(navigator.language||navigator.languages?.[0]||"nl-NL").startsWith("nl-BE")?"nl-BE":"nl-NL",[]),j=e.useCallback(()=>{u&&(clearTimeout(u),d(null)),k.current&&(clearInterval(k.current),k.current=null),b(!1),w(0)},[u]),N=e.useCallback(e=>{const t=Date.now();return!("no-speech"===e&&x||t-p<h)},[p,h,x]),S=e.useCallback(()=>{j(),b(!0),w(g),k.current=setInterval(()=>{w(e=>e<=100?0:e-100)},100);const e=setTimeout(()=>{k.current&&(clearInterval(k.current),k.current=null),T()},g);d(e)},[g,j]),M=e.useCallback(()=>{r&&S()},[r,S]),T=e.useCallback(()=>{if(v.current&&r){j();const e=v.current.onend;v.current.onend=()=>{a(!1),v.current&&(v.current.onend=e)},v.current.stop()}},[r,j]);e.useEffect(()=>{if("webkitSpeechRecognition"in window||"SpeechRecognition"in window){o(!0);const e=window.SpeechRecognition||window.webkitSpeechRecognition;v.current=new e;const r=v.current;r.continuous=!1,r.interimResults=!0,r.lang=t||y(),r.maxAlternatives=1,r.onstart=()=>{a(!0),c(""),S()},r.onend=()=>{a(!1),j()},r.onresult=e=>{let t="",r="";for(let a=e.resultIndex;a<e.results.length;a++){const n=e.results[a];n.isFinal?t+=n[0].transcript:r+=n[0].transcript}if((t||r)&&M(),t){const e=L(t.trim());s(e)}},r.onerror=e=>{const t=Date.now();if(j(),a(!1),N(e.error))switch(m(t),e.error){case"no-speech":x||c("Geen spraak gedetecteerd. Probeer opnieuw.");break;case"audio-capture":c("Microfoon niet beschikbaar.");break;case"not-allowed":c("Microfoon toegang geweigerd.");break;case"network":c("Netwerkfout. Controleer je internetverbinding.");break;default:c("Er ging iets mis met de spraakherkenning.")}}}else o(!1);return()=>{j(),v.current&&v.current.stop()}},[t,y,S,M,j,N,x]);const L=e=>{const t=e.toLowerCase().trim(),r=[{regex:/^voeg toe (.+)/,replacement:"$1"},{regex:/^ik heb nodig (.+)/,replacement:"$1"},{regex:/^ik wil (.+)/,replacement:"$1"},{regex:/^koop (.+)/,replacement:"$1"},{regex:/^nieuwe lijst (.+)/,replacement:"$1"},{regex:/^maak lijst (.+)/,replacement:"$1"}];for(const a of r)if(a.regex.test(t))return t.replace(a.regex,a.replacement);return e.trim()},$=e.useCallback(()=>{if(v.current&&!r&&i){s(""),c(""),j();try{v.current.start()}catch(e){c("Kan spraakherkenning niet starten."),j()}}},[r,i,j]),C=e.useCallback(()=>{s(""),c("")},[]);return{isListening:r,transcript:n,isSupported:i,error:l,isTimingOut:x,remainingTime:f,startListening:$,stopListening:T,resetTranscript:C}})(l),{error:y,success:j}=i(),[N,S]=e.useState(null),[M,T]=e.useState(!1);e.useEffect(()=>{(async()=>{if(navigator.permissions)try{const e=await navigator.permissions.query({name:"microphone"});S("granted"===e.state),"denied"===e.state&&T(!0),e.onchange=()=>{S("granted"===e.state),T("denied"===e.state)}}catch(e){S(!1)}})()},[]),e.useEffect(()=>{m&&(s(m),g&&j(`"${m}" toegevoegd via spraak! ðŸŽ¤`,2e3),setTimeout(()=>{k()},100))},[m,s,g,j,k]),e.useEffect(()=>{x&&("Microfoon toegang geweigerd."!==x&&"Microfoon niet beschikbaar."!==x||(S(!1),T(!0)),y(x,3e3))},[x,y]);return e.useEffect(()=>{x&&p&&setTimeout(()=>{p&&x&&v()},100)},[x,p,v]),h?t.jsxs("div",{className:`relative ${d}`,children:[t.jsxs(c.button,{onClick:async()=>{if(h)if(p)v();else if(!0!==N)try{(await navigator.mediaDevices.getUserMedia({audio:!0})).getTracks().forEach(e=>e.stop()),S(!0),T(!1),!0!==N&&j("Microfoon toegang verleend! Klik nogmaals om te beginnen. ðŸŽ¤",2e3)}catch(e){return S(!1),T(!0),void y("Microfoon toegang geweigerd. Klik op het slot-icoon in de adresbalk om toegang te verlenen.",6e3)}else w();else y("Spraakherkenning wordt niet ondersteund in deze browser.",4e3)},whileHover:{scale:1.05},whileTap:{scale:.95},className:`\n          relative flex items-center justify-center rounded-xl shadow-lg hover:shadow-xl\n          transform transition-all duration-200 overflow-hidden\n          ${!1===N?"bg-[rgb(var(--color-warning-button))] text-white px-4 py-3 animate-pulse":b?"bg-[rgb(var(--color-warning-button))] text-white p-3":p?"bg-[rgb(var(--color-accent-button))] hover:opacity-90 text-white p-3":"bg-[rgb(var(--color-secondary-button))] hover:opacity-90 text-white p-3"}\n        `,title:!1===N?"Klik om microfoon toegang te verlenen":b?`Stopt over ${Math.ceil(f/1e3)}s`:p?"Stop opname":`${o}`,children:[t.jsx(u,{children:p&&t.jsx(c.div,{initial:{scale:.8,opacity:0},animate:{scale:1.2,opacity:[.3,.6,.3]},exit:{scale:.8,opacity:0},transition:{duration:1.5,repeat:1/0},className:"absolute inset-0 bg-white rounded-xl"})}),t.jsx(c.div,{animate:p?{scale:[1,1.1,1]}:{scale:1},transition:{duration:.6,repeat:p?1/0:0},className:"relative z-10 flex items-center space-x-2",children:!1===N?t.jsxs(t.Fragment,{children:[t.jsx(r,{className:"w-5 h-5"}),t.jsx("span",{className:"font-medium text-sm",children:"Microfoon toegang"})]}):p?t.jsx(a,{className:"w-5 h-5"}):t.jsx(n,{className:"w-5 h-5"})}),t.jsx("div",{className:"absolute inset-0 rounded-xl bg-white/10 backdrop-blur-sm"})]}),t.jsx(u,{children:p&&t.jsx(c.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},className:"absolute top-full left-1/2 transform -translate-x-1/2 mt-2 z-20",children:t.jsx("div",{className:"bg-[rgb(var(--card-bg))] text-[rgb(var(--card-text))] px-3 py-2 rounded-lg shadow-lg border border-[rgb(var(--border-color))]/20",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:"flex space-x-1",children:[...Array(3)].map((e,r)=>t.jsx(c.div,{animate:{scale:[1,1.5,1]},transition:{duration:.6,repeat:1/0,delay:.2*r},className:"w-1.5 h-1.5 bg-[rgb(var(--accent-color))] rounded-full"},r))}),t.jsx("span",{className:"text-sm font-medium",children:"Luisteren..."})]})})})}),t.jsx(u,{children:b&&t.jsx(c.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},className:"absolute top-full left-1/2 transform -translate-x-1/2 mt-2 z-20",children:t.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 text-yellow-700 dark:text-yellow-300 px-3 py-2 rounded-lg shadow-lg border border-yellow-200 dark:border-yellow-800",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:"w-4 h-4 rounded-full border-2 border-current relative overflow-hidden",children:t.jsx(c.div,{className:"absolute inset-0 bg-current origin-center",style:{clipPath:`polygon(50% 50%, 50% 0%, ${50+50*Math.cos(2*Math.PI*(1-f/3e3)-Math.PI/2)}% ${50+50*Math.sin(2*Math.PI*(1-f/3e3)-Math.PI/2)}%, 50% 50%)`}})}),t.jsxs("span",{className:"text-sm font-medium",children:["Stopt over ",Math.ceil(f/1e3),"s"]})]})})})}),t.jsx(u,{children:!1})]}):null};d.propTypes={onTranscript:l.isRequired,placeholder:s.string,language:s.string,className:o,autoSubmit:s.bool},d.defaultProps={placeholder:"Spreek uit...",language:"nl-NL",className:"",autoSubmit:!1};export{d as default};
